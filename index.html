<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>рж▓рзЛржи рж╣рж┐рж╕рж╛ржм</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./script.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f0f5; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; max-width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
    th { background: #ddd; }
    tfoot td { font-weight: bold; background: #fff5e6; }
    .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: auto; }
    .summary { margin-top: 20px; background: #fff5e6; padding: 15px; border-radius: 8px; }
    .summary p { margin: 5px 0; font-weight: bold; }
    #userForm { display: none; margin-top: 10px; }
    #loginLink { position: absolute; top: 10px; right: 20px; }
    #globalSummary { background: #e6ffe6; margin-top: 30px; padding: 15px; border-radius: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <a href="login.html" id="loginLink">ЁЯФР рж▓ржЧ ржЗржи</a>
  <div class="container">
    <h1>ЁЯУК рж▓рзЛржи рж╣рж┐рж╕рж╛ржм</h1>
    <label>рж▓рзЛржи ржирзЗрзЯрж╛рж░ рждрж╛рж░рж┐ржЦ:</label><br>
    <input type="date" id="loanStartDate" max="" /><br>
    <label>рж▓рзЛржирзЗрж░ ржкрж░рж┐ржорж╛ржг (рз│):</label><br>
    <input type="number" id="amount" placeholder="ржпрзЗржоржи: 1500"><br>
    <label>ржкрзНрж░рж╕рзЗрж╕рж┐ржВ ржлрж┐ (%):</label><br>
    <input type="number" id="processingFee"  placeholder="ржпрзЗржоржи: 1"><br>
    <label>рж╕рзБржжрзЗрж░ рж╣рж╛рж░ (ржмрж╛рзОрж╕рж░рж┐ржХ %):</label><br>
    <input type="number" id="annualRate"><br>
    <label>рж╕рзБржжрзЗрж░ рж╣рж╛рж░ (ржорж╛рж╕рж┐ржХ %):</label><br>
    <input type="number" id="monthlyRate"placeholder="ржпрзЗржоржи: 6.7"><br>
    <label>рж╕ржоржпрж╝ (ржорж╛рж╕рзЗ):</label><br>
    <input type="number" id="months"placeholder="ржпрзЗржоржи: 3"><br>
    <button onclick="calculateEMI()">рж╣рж┐рж╕рж╛ржм ржХрж░рзБржи</button>

    <div id="pdfContent" style="margin-top:20px;">
      <div class="summary" id="loanSummary" style="display:none;">
        <h3>ЁЯУМ рж▓рзЛржирзЗрж░ рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк</h3>
        <p id="netAmountResult"></p>
        <p id="emiResult"></p>
        <p id="totalPrincipalLine"></p>
        <p id="totalInterestLine"></p>
        <p id="totalPaymentLine"></p>
        <button onclick="downloadPDF()">ЁЯУе PDF ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи</button>

        <div id="userForm">
          <h4>ЁЯЩЛ ржЖржкржирж╛рж░ ржирж╛ржо ржУ ржорзЛржмрж╛ржЗрж▓ ржирж╛ржорзНржмрж╛рж░ ржжрж┐ржи:</h4>
          <input type="text" id="userName" placeholder="ржЖржкржирж╛рж░ ржирж╛ржо">
          <input type="text" id="userPhone" placeholder="ржорзЛржмрж╛ржЗрж▓ ржирж╛ржорзНржмрж╛рж░">
          <button onclick="submitLoanRequest()">ЁЯУи рж╕рж╛ржмржорж┐ржЯ</button>
          <p id="submitMessage" style="color:green; font-weight:bold;"></p>
        </div>
      </div>

      <table id="scheduleTable" style="display:none;">
        <thead>
          <tr><th>ржорж╛рж╕</th><th>ржорзВрж▓ржзржи (рз│)</th><th>рж╕рзБржж (рз│)</th><th>ржорзЛржЯ ржХрж┐рж╕рзНрждрж┐ (рз│)</th><th>ржмрж╛ржХрж┐ ржЛржг (рз│)</th><th>рждрж╛рж░рж┐ржЦ</th></tr>
        </thead>
        <tbody id="scheduleBody"></tbody>
        <tfoot>
          <tr>
            <td>ржорзЛржЯ</td>
            <td id="totalPrincipal">0.00</td>
            <td id="totalInterest">0.00</td>
            <td id="totalPayment">0.00</td>
            <td>тАФ</td>
            <td>тАФ</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- тЬЕ ржирждрзБржи рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк рж╕рзЗржХрж╢ржи -->
    <div id="globalSummary" class="summary">
      <h3>ЁЯМР рж╕рж╛рж░рзНржмрж┐ржХ рж▓рзЛржирзЗрж░ рждржерзНржп</h3>
      <p id="approvedTotal">ржорзЛржЯ ржЕржирзБржорзЛржжрж┐ржд рж▓рзЛржи: </p>
      <p id="pendingTotal">ржкрзЗржирзНржбрж┐ржВ рж▓рзЛржи: </p>
      <p id="paidTotal">ржкрж░рж┐рж╢рзЛржзрж┐ржд ржХрж┐рж╕рзНрждрж┐: </p>
      <p id="userCount">ржорзЛржЯ рж▓рзЛржи ржЗржЙржЬрж╛рж░: </p>
      <p id="pendingUserCount">ржкрзЗржирзНржбрж┐ржВ ржЗржЙржЬрж╛рж░ рж╕ржВржЦрзНржпрж╛: </p>
    </div>

  </div>

  <script>
    // Set max date to today for loanStartDate input
    const loanStartInput = document.getElementById('loanStartDate');
    if(loanStartInput){
      const today = new Date().toISOString().split('T')[0];
      loanStartInput.setAttribute('max', today);
      loanStartInput.value = today;
    }
  </script>
    <div style="margin-top: 20px; text-align: center;">
    <button style="padding: 10px 20px; margin: 5px;" onclick="history.back()">тмЕя╕П ржкрж┐ржЫржирзЗ</button>
    <button style="padding: 10px 20px; margin: 5px;" onclick="location.reload()">ЁЯФД рж░рж┐рж▓рзЛржб</button>
    <button style="padding: 10px 20px; margin: 5px;" onclick="history.forward()">тЮбя╕П рж╕рж╛ржоржирзЗ</button>
  </div>

</body>
</html>
